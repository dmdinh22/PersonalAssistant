
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Address Book</h2>

<div class="col-lg-12" ng-controller="contactsController as cntCtrl">
    <br />
    <button class="btn btn-info" ng-click="cntCtrl.addPerson()">Add Contact</button>
    <br />
    <br />
    <table class="table table-striped table-hover table-bordered table-responsive">
        <thead class="thead-inverse">
            <tr>
                @*<th>ID</th>*@
                <th>First Name</th>
                <th>Last Name</th>
                <th>Phone Number</th>
                <th>Email</th>
                <th>Address</th>
                <th>Edit/ Remove</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="person in cntCtrl.people">
                @*<td>{{person.id}}</td>*@
                <td>{{person.firstName}}</td>
                <td>{{person.lastName}}</td>
                <td>{{person.phoneNumber}}</td>
                <td>{{person.email}}</td>
                <td>120 Newport Center Dr., 
                    <br /> Newport Beach, CA 92660</td>
                <td>
                    <a class="fa fa-pencil-square-o" aria-hidden="true" ng-click="tskCtrl.editTask()"></a>
                    <a class="fa fa-times" aria-hidden="true" ng-click="tskCtrl.deleteTask()"></a>
                </td>
          
            </tr>
        </tbody>
    </table> 

</div>

@section scripts {
    <script>
        (function () {
            angular.module('jarvisApp')
                .factory("$contactServiceFactory", $ContactServiceFactory);

            $ContactServiceFactory.$inject = ['$http'];

            function $ContactServiceFactory($http) {

                return {
                    getPeople: _getPeople
                }

                function _getPeople() {
                    console.log("getting data from db...");
                    return $http.get('/api/people')
                        .then(getPeopleSuccess)
                        .catch(onError);
                }

                function getPeopleSuccess(response) {
                    console.log("successfully retrieved data");
                    return response.data;
                }

                function onError() {
                    console.log("ERROR!");
                    alert("YOU FUCKED UP!")
                }
            }

        })();

        (function () {
            angular.module('jarvisApp')
                .controller('contactsController', ContactsController);

            ContactsController.$inject = ['$scope', '$contactServiceFactory'];

            function ContactsController($scope, $contactServiceFactory) {
                var vm = this;

                vm.$scope = $scope;
                vm.$contactServiceFactory = $contactServiceFactory;

                vm.people = null;

                //hoisted functions
                vm.getPeople = _getPeople;
                vm.addPerson = _addPerson;

                //-- THE FOLD --
                render();

                function render() {
                    console.log("rendering...");
                    return vm.getPeople()
                        .then(getPeopleSuccess);
                }

                function _getPeople() {
                    console.log("getting all contacts...")

                    return $contactServiceFactory.getPeople()
                        .then(retrievePeople);
                }

                function retrievePeople(data) {
                    console.log("retrieve people data..")
                    vm.people = data;
                }

                function getPeopleSuccess() {
                    console.log("completed render and retrieving people data")
                }

                function _addPerson() {
                    window.location = "/people/create"
                }
            }


        })();
    </script>
    
    
    
    }